# uCore Lab3 Report
@author 张敬卿 2012011380

## 1. 实现方法
1. 首先通过PDE获得PTE
2. 如果PTE为空不在物理内存中，需要将PTE加载到内存中
	3. 加载PTE到物理内存中需要根据置换算法置换某一个PTE出去
	4. 置换算法的具体实现在swap_fifo先入先出中实现，即找到队列中最先的页表项并删除
3. 如果PTE存在但是指向的空间不在物理内存中，需要将该空间从外存加载到内存中
	4. 首先获取该空间在外存中的位置
	5. 建立物理内存地址到虚拟内存地址的映射，期间需要根据置换算法删除某一个PTE
	6. 将新PTE加载到队列中末尾

## 2. 思考题
1. 请描述页目录项（Page Director Entry）和页表（Page Table Entry）中组成部分对ucore实现页替换算法的潜在用处。
	2. PTE中的PTE_P来判断PTE对应的空间是否在物理内存中
	3. 当页表项需要被置换出去的时候，PTE的索引值右移三位即为磁盘置换页扇区的起始位置
	4. 当页表项需要被置换入物理内存的时候，PTE高24位应该不为0且最低位应该为0，依次检查虚拟地址的合法性
2. 如果ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？
	3. CPU需要保存异常触发时的程序现场，依次压入当前被打断程序使用的EFLAGS，CS，EIP，errorCode
	4. 由于页访问异常的中断号是0xE，CPU把异常中断号0xE对应的中断服务例程的地址（vectors.S中的标号vector14处）加载到CS和EIP寄存器中，开始执行中断服务例程 
3. 如果要在ucore上实现"extended clock页替换算法"请给你的设计方案，现有的swap_manager框架是否足以支持在ucore中实现此算法？如果是，请给你的设计方案。如果不是，请给出你的新的扩展和基此扩展的设计方案。并需要回答如下问题
	1. 需要被换出的页的特征是什么？
		2. 只有映射到用户空间且被用户程序直接访问的页面才能被交换，而被内核直接使用的内核空间的页面不能被换出
	2. 在ucore中如何判断具有这样特征的页？
		3. 实验三中仅仅通过执行check\_swap函数在内核中分配一些页，模拟对这些页的访问，然后通过do\_pgfault来调用swap\_map\_swappable函数来查询这些页的访问情况并间接调用相关函数，换出“不常用”的页到磁盘上. 
	3. 何时进行换入和换出操作？
		4. 当ucore或应用程序访问地址所在的页不在内存时，就会产生page fault异常，引起调用do\_pgfault函数，此函数会判断产生访问异常的地址属于check\_mm\_struct某个vma表示的合法虚拟地址空间，且保存在硬盘swap文件中（即对应的PTE的高24位不为0，而最低位为0），则是执行页换入的时机，将调用swap\_in函数完成页面换入
		5. ucore目前大致有两种策略，即积极换出策略和消极换出策略。积极换出策略是指操作系统周期性地（或在系统不忙的时候）主动把某些认为“不常用”的页换出到硬盘上，从而确保系统中总有一定数量的空闲页存在，这样当需要空闲页时，基本上能够及时满足需求；消极换出策略是指，只是当试图得到空闲页时，发现当前没有空闲的物理页可供分配，这时才开始查找“不常用”页面，并把一个或多个这样的页换出到硬盘上。在实验三中的基本练习中，支持上述的第二种情况。对于第一种积极换出策略，即每隔1秒执行一次的实现积极的换出策略，可考虑在扩展练习中实现。对于第二种消极的换出策略，则是在ucore调用alloc\_pages函数获取空闲页时，此函数如果发现无法从物理内存页分配器获得空闲页，就会进一步调用swap\_out函数换出某页，实现一种消极的换出策略。
